{% extends 'base.html' %}
{% block content %}
    <div class="card text-center">
        <div class="card-header">
        About HANCHAN
        </div>
        <div class="card-body">
            <h5 class="card-title">jsut get u r banchan </h5>
            <p class="card-text">입맛에 맞는 반찬을 집 가까이서 만나보세요</p>
            <!-- 반찬 검색 -->
            <form method="POST" action="{% url 'home' %}">
                <div class="form-search"> 
                    {%csrf_token%} 
                    <input type="text" name="banchan" placeholder="검색어를 입력해주세요.">
                </div>
            </form>
        </div>

        <div class="card-footer text-muted">
        항공대 멋쟁이 사자들 9기 oldman&potatos
        </div>
    </div>


    <div class="card text-center">
        <div class="card text-center">
            <!--지도내 등록된 반찬가게 핀으로 띄우기-->
            <div class="card-header">
              지도 보기
            </div>
            <div class="card-body">
                <div id="map" style="width:100%;height:350px;"></div>
                <br>
                <h5 class="card-title">지도를 클릭해 주세요</h5> 
                <div id="clickLatlng"></div>
                <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b284383e8322b89bab85bd52109cdda5&libraries=services"></script>

                <script>
                //등록된 주소에서 위치한 반찬 가게 보여주기     
                let isAuthenticated = '{{request.user.is_authenticated}}';
                let center = 0;
                // 로그인 되면 주소에 
                var geocoder = new kakao.maps.services.Geocoder();
                if (isAuthenticated === 'True'){    
                    let addr = '항공대학로 76';
                    geocoder.addressSearch(addr, function(result,status){
                        if(status === kakao.maps.services.Status.OK){
                            center = new kakao.maps.LatLng(Number(result[0].y),Number(result[0].x));
                            document.getElementById("xy").innerHTML = result[0].x;
                            document.getElementById("geo").innerHTML = result[0].y;
                        }
                    });
                    //center = new kakao.maps.LatLng(33.451393, 126.570738);
                }else{
                    center = new kakao.maps.LatLng(33.451393, 126.570738);
                }

                window.onload=()=>{
                    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
                    mapOption = { 
                        center: center, // 지도의 중심좌표
                        level: 3 // 지도의 확대 레벨
                    };
                    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
                        // 지도를 클릭한 위치에 표출할 마커입니다
                    var marker = new kakao.maps.Marker({ 
                        // 지도 중심좌표에 마커를 생성합니다 
                        position: map.getCenter() 
                    }); 
                    // 지도에 마커를 표시합니다
                    marker.setMap(map);
                    // 지도에 클릭 이벤트를 등록합니다
                    // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
                    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
                        // 클릭한 위도, 경도 정보를 가져옵니다 
                        var latlng = mouseEvent.latLng; 
                        // 마커 위치를 클릭한 위치로 옮깁니다
                        marker.setPosition(latlng);

                        var message = '클릭한 위치의 위도는 ' + latlng.getLat() + ' 이고, ';
                            message += '경도는 ' + latlng.getLng() + ' 입니다';
                        var resultDiv = document.getElementById('clickLatlng'); 
                        resultDiv.innerHTML = message;
                    });
                    var content = '<div class="wrap">' + 
                        '    <div class="info">' + 
                        '        <div class="title">' + 
                        '            카카오 스페이스닷원' + 
                        '            <div class="close" onclick="closeOverlay()" title="닫기"></div>' + 
                        '        </div>' + 
                        '        <div class="body">' + 
                        '            <div class="img">' +
                        '                <img src="https://cfile181.uf.daum.net/image/250649365602043421936D" width="73" height="70">' +
                        '           </div>' + 
                        '            <div class="desc">' + 
                        '                <div class="ellipsis">제주특별자치도 제주시 첨단로 242</div>' + 
                        '                <div class="jibun ellipsis">(우) 63309 (지번) 영평동 2181</div>' + 
                        '                <div><a href="https://www.kakaocorp.com/main" target="_blank" class="link">홈페이지</a></div>' + 
                        '            </div>' + 
                        '        </div>' + 
                        '    </div>' +    
                        '</div>';

                    var overlay = new kakao.maps.CustomOverlay({
                        content: content,
                        map: map,
                        position: marker.getPosition()       
                    });
                }
                kakao.maps.event.addListener(marker, 'click', function() {
                        overlay.setMap(map);
                    });
                </script>
            </div>
            <div class="card-footer text-muted">
              카카오 MAP API 이용
            </div>
        </div>
        <div id="xy"> </div>
        <div id="geo"> </div>
    </div>
{% endblock %}